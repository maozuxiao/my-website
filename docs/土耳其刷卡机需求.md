---
title: 土耳其刷卡机需求
author: Sean Mao
keywords:
- 问题处理步骤
- 说明
- Business,Enterprise,FAE,Technical Support
- 海外营销中心-欧洲战区-土耳其区
- 仅内部使用
vlook-welcome: Streamax
vlook-header-autonum: h1{{Chapter ###. }},h2{{Chapter ###. }},h3{{Chapter ###. }},h4{{Chapter ###. }},h5{{Chapter ###. }}
layout: default
vlook-query: coating=bu&ws=3&toc=3
vlook-header-dup: 
---

###### ✒️土耳其刷卡机需求<br />*Version 1.0`🐾`16th December*<br />*一般`👀`部门可见*<br />**** <br />[✉️](mailto:sean@streamax.com)<br />**Sean°Mao**<br>*<img alt="今日诗词" src="https://v2.jinrishici.com/one.svg?font-size=23&amp;spacing=2&amp;color=White" style="max-width:100%; display: block; margin: 0;">*

# 土耳其刷卡机需求

[TOC]

> [!NOTE]
>
> 1. 在土耳其市场的历史收集过程中，我们识别出 **3 项核心需求**。这些需求此前分散在不同产品线中分别实现。经内部评估，我们决定将这 3 项需求**统一纳入土耳其标准版本的基线需求**，作为后续产品迭代的默认配置。
>2. 该文档合并了471和3914这2个客户的刷卡机需求，合并为一个文档，112文档单独输出

## Revision History

| 日期       | 版本号 | 作者 | 说明                                                |
| ---------- | ------ | ---- | --------------------------------------------------- |
| 2025-12-16 | V1.0   | Sean | 新建文档，梳理需求<br />感谢Emrys、CE提供的指导建议 |






## 3864（471）客户-公交项目需求汇总


### 概述

#### 背景

3864（471）客户曾是海外第一大客户，总部位于土耳其Izmir，是专注于全球的刷卡机业务和公交相关业务的公司，专业化程度非常高；该公司最早于2012年即开始与锐明合作，与公司产生了深厚的联系；3864（471）客户于2018年后因自身发展原因和锐明合作减少，但自2022年开始，公交相关业务和整合需求不断导入锐明，ITxPT联调、刷卡机、公交基础监控等需求不断更新，客户也在持续下单设备，有逐渐恢复全面合作的趋势

#### 系统组成

| 产品 |     名称     | 软件路径                                                     | 备注                           |
| :--: | :----------: | ------------------------------------------------------------ | ------------------------------ |
| MDVR |   A8PRO2.0   | **软件名称**：BUS_A8PRO2.0_M04.1029_V359_1029_B242_RC25091560<br />**路径**：[企业内容库\STREAMAX\STREAMAX 锐明技术\Product Department产品发展中心\Public Transportation-公交产品线\外部文件External\软件发布\8系列主机\A8ProV2.0\3914\国标](https://wj.streamax.com:9443/index.html#doc/enterprise/918572) | A8PRO2.0所有子机型都用一个版本 |
|  :   | X7NPRO-H0416 | **软件名称**：ST_X7N_M04.1029_V3.5.6.9_R24103001<br />**路径**：[企业内容库\STREAMAX\STREAMAX 锐明技术\Product Department产品发展中心\校车警用产品线（School bus&Police）\校车 School Bus\软件版本\客户定制版本\欧洲\3914(1029)\X7NPRO-H0416](https://wj.streamax.com:9443/index.html#doc/enterprise/198986) |                                |
|  :   |  X3N-H0208   |                                                              | 待支持                         |
|  :   | A16MAX(IBCU) |                                                              | 待支持                         |
|  :   | X7NPRO-H1608 |                                                              | 待支持                         |

#### 引用文件

> * [471客户需求文档（V2.4）2025-05-08.docx](https://alidocs.dingtalk.com/i/nodes/XPwkYGxZV3R1bB6gFgPrRv0KWAgozOKL?utm_scene=team_space)

### 功能需求

#### 语言需求

> 1. 多语言包只保留英文和土耳其语，并且**默认语言为土耳其语**_~Rd~_
> 2. 无论英语还是土耳其语，默认日期格式均需为DD/MM/YYYY的格式

#### 支持刷卡信息的OSD叠加

> [!CAUTION]
>
> 一个版本支持2个不同客户的OSD，会根据对应客户发送的协议显示对应客户的OSD，因此不会存在冲突，无需使用额外的开关进行控制

##### TCP端口说明

> 在N9M设备上，本地网口TCP通信端口固定`65500`

##### 显示要求

> [!NOTE]
>
> -	由3行叠加变成5行叠加；为了让客户的刷卡兼容新老MDVR，所以客户可以选择发送3行或者5行，但是必须为其中之一 （如下显示需求中文部分已经修改为5行描述，因为目前对接的机型可认定为新MDVR）
> -	支持长显示，即直到下一次更新位置，OSD一直不消失，在ROW开头加#作为长显示标识
>   ![IP & Port](https://cdn.jsdelivr.net/gh/maozuxiao/Misaki/image-20251216105137672.png#40%)

_^Tab^_

> **显示要求**
>
> * 数据包包含**五行**文本，每行由 20 个 ASCII 字符（即 20 字节）组成。
>
> * 数据包包含一个校验字节，该字节通过对所有行中全部字节进行异或（XOR）运算生成。
>
> * 数据包使用 STX（起始字符）和 ETX（结束字符）进行封装，用于标识数据包的开始与结束。
>
> * 发送的每条刷卡信息叠加在录像码流，显示2秒后消失，回放显示在左上角；如果在2秒内收到多条刷卡信息，则叠加最新的刷卡信息。
>
> * 支持录像中OSD叠加的位置的配置。
>
> * 5行字符串的显示要求同步刷新。
>
> * 网传码流增加刷卡信息OSD叠加
>
> * 可以对特定通道开启/关闭OSD的叠加，对字体类型、字号、颜色或文本位置无特殊要求，可按以下固定方式处理：
>
>   - **字体颜色**：背景色为黑色，前景色（文字颜色）为红色。
>   - **字体类型与字号**：可自行选择，但必须确保文字清晰易读。
>   - **文本位置**：假设视频画面边框为黑色区域，文字显示区域为红色区域；**五行文本**应置于视频画面的**右上角**。
>
>   <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=932 height=601 src="https://edrawcloudpublicus.s3.amazonaws.com/viewer/self/2539370/share/2025-12-16/1765876192/main.svg"></iframe>
>
>   
>
> 

> **客户原文**
>
> There are three rows which each one includes 20 ascii chars (20 bytes). 
>
> There is also one byte checksum which generated from XOR of all bytes of rows. 
>
> There are also STX and ETX which encapsulates the package and informs the start and the end of the package. 
>
> There is nothing about font type, font size, color or text location. These can be fixed like below. 
>
> For font color : background color can be black and foreground color (text color) can be red.
>
> For font type, font size : it is up to you, but it must be readable easily. 
>
> For text location: suppose the black one is the video frame border. The red one is the text area. Please place the three rows at the top right of the video like below. 
>
> <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=932 height=601 src="https://edrawcloudpublicus.s3.amazonaws.com/viewer/self/2539370/share/2025-12-16/1765876192/main.svg"></iframe>
>
> When a text message sends, it will be shown for 2 seconds on the video and then it will disappear. But if a new message sends, it will be shown immediately without waiting 2 seconds for previous one.

##### 叠加协议

TCP connection. Port number : any port . it is up to you. 

```TCP
Response is 1 byte. 
For success return 0x06, for failure return 0x15. 
---------------------------------------------------
TCP connection. Port number : 65500
Package contains ->[ STX | ROW1 | ROW2 | ROW3| *ROW4|*ROW5  | LRC | ETX ]
STX : start of transmission. 0x02. 1 byte
ROW(#):ascii 20 chars fixed. 20 byte each row.  Example : “123456789abcdef     ”, “     12345     12345     ” etc ... empty char will be 0x20 space char. Not null char like 0x00
LRC: 1 byte checksum. Xor of total of all rows (ROW1 + ROW2 + ROW3+*ROW4+*ROW5). 100 bytes.
ETX : end of transmission. 0x03. 1 byte
Total package byte is : 1 + 20 + 20 + 20 + 20 + 20 + 1 + 1 = 103 bytes
```

##### 单独控制OSD叠加通道



| 标题       | 详情                                                         |
| ---------- | ------------------------------------------------------------ |
| 动机和原因 | 客户在推广该系统多年，收到政府对系统的优化建议。<br />考虑到【刷卡叠加】信息占用的版面较大，原系统的设计又是全部IPC通道都叠加信息，导致车内录像大部分细节丢失。<br />实际上，政府部分IPC通道叠加该信息即可，比如司机驾驶舱通道和额外的前门上客通道 |
| 需求描述   | 默认在所有出图的通道显示刷卡OSD，当客户不需要再某些通道显示时，取消勾选则可以在该通道不显示。  <br />1.支持各个通道分别打开/关闭刷卡信息OSD展示。  <br />2.在Surveillance-Record-Record OSD界面，Swipe项下后面增加Setup按钮，点击进入通道勾选界面。勾选时会在该通道叠加刷卡信息OSD。默认全部勾选。  <br />3. 该设置可以用参数的方式进行导入、导出  <br />4. 运维宝同步支持该设置  <br />5. 远程配置支持该设置  <br />6. 该参数保存即生效，无需重启设备。<br />![Record OSD-Swipe Setup](https://cdn.jsdelivr.net/gh/maozuxiao/Misaki/image-20251216172458830.png#40%) |
| 正常场景   | 1.默认是全部通道显示【刷卡叠加】信息  <br />2.点击并勾选后，则某特定通道显示并叠加刷卡信息 |
| 异常场景   | 1.未被勾选的通道也显示刷卡信息<br />2.取消勾选后叠加信息依然存在，需要关机重启才能 |
| 性能要求   | 由于添加通道使用的联动，影响主机的性能，导致OSD叠加延时，需要尽力避免 |

#### FTP协议联调

> [!CAUTION]
>
> FTP协议联调（从20250508起，该需求废弃，请注意机型的使用场景），但是客户邮件说明需要支持该需求内的其中一点，需要BU和研发评估是否可行
> ![471需求邮件-1](https://cdn.jsdelivr.net/gh/maozuxiao/Misaki/image-20251216173517517.png#40%)
>
> 源文档参考：[471客户需求文档（V2.4）2025-05-08.docx](https://alidocs.dingtalk.com/i/nodes/XPwkYGxZV3R1bB6gFgPrRv0KWAgozOKL?utm_scene=team_space) 中的 `2.2.10`章节

> ###### 废弃需求
>
> 

##### Type10：外置报警信息指令

> ```FTP
> 指令: TRIGGER_ALARM
> 测试指令格式: TRIGGER_ALARM P T TS
> P[优先级]: 报警紧急等级, 1~9级,1最高，9最低
> T[类型]: 报警类型, text, 最大20字符. 示例: “Trip Start Late”
> TS[时间戳]: 报警发生时间，日期时间格式为 DDMMYYYYHHMMSS  
> 示例: TRIGGER_ALARM 1 Breakdown 15082019100145，一个叫“Breakdown”的最高等级报警发生在15 Aug 2019, 10:01:45
> 应答格式  
> 	成功返回200
> 	失败返回500
> ```
>
> 

#### 在设备上面增加水印功能

* 增加水印功能，在主码流OSD叠加功能里添加水印OSD开关，叠加效果如”kentkart”透明字体，大小字体位置如下图（左上角），要求内容可编辑。
  ![Kentkart WaterMark](https://cdn.jsdelivr.net/gh/maozuxiao/Misaki/image-20251217101205935.png#40%)
  ![OSD Watermark](https://cdn.jsdelivr.net/gh/maozuxiao/Misaki/image-20251222093832658.png#40%)
  
* 水印默认为`空`~~“Kentkart”~~，可以由客户自定义编辑，配置保持后，可以保存在config文件内，方便导入到其他设备

* 水印功能要求模拟通道和IPC通道均支持。模拟通道和IPC通道在设备端和Web端都能设置使能开关、编辑内容

#### 主机端支持ITxPT协议
> [!NOTE]
>
> 1. 大部分的国标项目不会有P3，**建议第一期软件此需求忽略**_~Rd~_。以后需要的话，再单独讨论
> 2. 如开发此需求，需要考虑是否会对其他客户产生影响
> 

> ###### 主机端支持ITxPT协议
>
> * 主机端支持此协议，可以实现主机直接和471的车载电脑（OBU）进行连接，通过ITxPT协议完成相关信息和内容的抓取，例如设备的录像情况、客流仪等信息；
> * 需要针对471原有的基于FTP的相关需求进行移植评估，保持旧有的联调功能并支持新增的ITxPT协议；
>
> > 相关的文件请下载： [471客户需求文档（V2.4）2025-05-08.docx](https://alidocs.dingtalk.com/i/nodes/XPwkYGxZV3R1bB6gFgPrRv0KWAgozOKL?utm_scene=team_space) ,搜索关键词`主机端支持ITxPT协议`
>
> | 标题       | 说明                                                         |
> | ---------- | ------------------------------------------------------------ |
> | 动机和原因 | 客户OBU与我们的ITxPT版本P3已调试正常，但是OBU与P3都接在X7SE设备上<br />我们设备后面PON口默认带网口隔离，需要去掉网口隔离，让客户OBU与P3能建立网络通讯； |
> | 正常场景   | 客户OBU与P3之间能正常进行网络互联，参照ITxPT框架协议进行通讯 |
> | 异常场景   | 客户OBU需要与我们设备及P3处于10.100.100.X网段；              |
> | 需求描述   | 1、基于客户定制的X7SE版本  X7SE_V262.C_T200512.07_T04.471_FS4.0;  <br />2、取消X7SE后面板的网口隔离功能；  3、客户OBU 改为10.100.100.X网段后可以与P3正常互相访问，建立ITxPT协议互联； |
> | 性能要求   | 设备正常开机启动网卡加载成功后，后面板各网口即可相互访问；   |
> | 机型/平台  | X7SE, etc.                                                   |
> | 补充信息   | 无                                                           |
>
> ##### X7SE支持ITxPT系统互联
>
> ![471 X7SE 项目系统连接图](https://cdn.jsdelivr.net/gh/maozuxiao/Misaki/20251217105239211.png)
>
> 
>
> ##### 主机去除内部IP隔离需求
>
>
> | 标题       | 说明                                                         |
> | ---------- | ------------------------------------------------------------ |
> | 动机和原因 | 471客户自己的OBU通过LAN口连接MDVR，并且通过与MDVR上的P3进行通讯，通过ITxPT协议来进行客流数据对接；<br />历史的X7SE与A8ProV1.0皆按此方式进行对接使用，A8ProV2.0未识别到词条需要作为定制需求处理，导致目前无法通讯使用 |
> | 正常场景   | 对客户A8ProV2.0定制版本做需求开发，实现对内置IP隔离的去除，实现下图网络架构下，客户OBU与P3【设置为同一网段】之间进行网络互通<br />![471 IP isolation diagram](https://cdn.jsdelivr.net/gh/maozuxiao/Misaki/471%E4%B8%BB%E6%9C%BA%E5%8E%BB%E9%99%A4%E5%86%85%E9%83%A8IP%E9%9A%94%E7%A6%BB%E9%9C%80%E6%B1%82.gif#40%) |
> | 异常场景   | 暂无                                                         |
> | 需求描述   | 去掉A8ProV2.0的LAN口与IPC口之间的网络隔离，实现三方设备连接LAN口后对IPC的访问 |
> | 性能要求   | 暂无                                                         |
> | 机型/平台  | A8ProV2.0                                                    |
> | 补充信息   | BUS_A8PRO2.0_M04.471_V3.5.7.2_BUS_04.471_R23111703<br />客户目前使用Crocus版本：Crocus_v1.3.8.4_windows_en.exe |




------

## 3914-ASIS客户-刷卡城市国标项目需求


### 概述

#### 背景

ASIS为土耳其一家规模庞大的刷卡机公司，与当地政府和其他运输公司合作紧密。ASIS客户为刷卡机厂商，购买我司主机是为了更好地搭配他们自己的刷卡机，同时实现刷卡与监控功能，达到更好地向市场推广的目的。

2023年，ASIS客户全面发力多个城市公交的刷卡机业务，目前已经确认拿下来的有Diyarbakir、Bursa，合计约800台的设备。

另外Bursa城市是首次全面和大华在城市公交国标进行竞争，客户评审完POC后，我们和客户都认为把握很大，Bursa城市未来有1200台城市公交的替换需求，一旦锐明设备的重点功能写入标书，基本可以确认拿到此旧换新的机会；

另外还有两个城市共计2000台的城市公交机会，目前的进度势头良好，很有希望今年做下来；目前针对土耳其的公交国标，ASIS的潜力很大，就目前的市场信息来看，他们对许多城市的影响非常深！

#### 系统组成



| 产品 |     名称     | 软件路径                                                     | 备注                           |
| :--: | :----------: | ------------------------------------------------------------ | ------------------------------ |
| MDVR |   A8PRO2.0   | **软件名称**：BUS_A8PRO2.0_M04.1029_V359_1029_B242_RC25091560<br />**路径**：[企业内容库\STREAMAX\STREAMAX 锐明技术\Product Department产品发展中心\Public Transportation-公交产品线\外部文件External\软件发布\8系列主机\A8ProV2.0\3914\国标](https://wj.streamax.com:9443/index.html#doc/enterprise/918572) | A8PRO2.0所有子机型都用一个版本 |
|  :   | X7NPRO-H0416 | **软件名称**：ST_X7N_M04.1029_V3.5.6.9_R24103001<br />**路径**：[企业内容库\STREAMAX\STREAMAX 锐明技术\Product Department产品发展中心\校车警用产品线（School bus&Police）\校车 School Bus\软件版本\客户定制版本\欧洲\3914(1029)\X7NPRO-H0416](https://wj.streamax.com:9443/index.html#doc/enterprise/198986) |                                |
|  :   |  X3N-H0208   |                                                              | 待支持                         |
|  :   | A16MAX(IBCU) |                                                              | 待支持                         |
|  :   | X7NPRO-H1608 |                                                              | 待支持                         |

#### 引用文件

> * [3914-ASIS客户-刷卡城市国标项目需求V1.0-2024-11-26.docx](https://alidocs.dingtalk.com/i/nodes/vy20BglGWOe9d4RESaq30gwrJA7depqY?utm_scene=team_space)

### 功能需求

#### 语言需求

> 1. 多语言包只保留英文和土耳其语，并且**默认语言为土耳其语**_~Rd~_
> 2. 无论英语还是土耳其语，默认日期格式均需为DD/MM/YYYY的格式

#### 联调客户刷卡机

| 标题     | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 动机目的 | 客户购买我司设备在实现监控功能之外，还想结合他们的刷卡机实现刷卡相关的功能，以便更好地向当地市场推广，因此希望我们的主机支持与刷卡机的通讯。 |
| 正常场景 | 1. 客户的刷卡机可以通过2种方式与主机连接：网口、232串口；常用的连接方式是：刷卡机会通过网线连接到主机的网口进行通信，因此需要我们支持此种连接方式（“常用连接方式”举例：A8PRO-H0412、X7SE-H0808设备的后板有专门预留的WAN/LAN网口，所以刷卡机会通过网线连接到主机）；<br>2. 连接刷卡机后，需要在主机上经过配置后，才可以使用刷卡机。<br>3. 连接刷卡机后，用户若想使用刷卡功能，只会通过刷卡机刷卡。 |
| 异常场景 | 如果有一个使用方法存在异常时，需要保证两种方式中其中一种通讯方式可以正常通讯。 |

##### 需求内容

_^Tab^_

> **网口通讯对接**
>
> > [!NOTE]
> >
> > 1. 端口7777，协议：UDP
> > 2. 调试工具请访问[3914-ASIS客户-刷卡城市国标项目需求V1.0-2024-11-26.docx](https://alidocs.dingtalk.com/i/nodes/vy20BglGWOe9d4RESaq30gwrJA7depqY?utm_scene=team_space)进行下载，关键词可搜索`网口通讯对接`
> >    ![TCP工具](https://cdn.jsdelivr.net/gh/maozuxiao/Misaki/20251217111608959.png#80%)
>
> ------
>
> - 叠加协议
>
>   ```
>   {
>   "VLDSNG":{
>   "task-info":{
>   "stopCurrent":{
>   "routeName":"VALİLİK|IRLIGANLI",    //2020新字段
>   "stopName":"Gayrettepe"               //2020新字段
>   }
>   },
>   "vehicle-info":{
>   "busRegistPlateNo":"34SZ1507",   
>   "speed":30.00,
>   "latitude":40.995752,
>   "longitude":28.723370
>   },
>   "transaction-info":{
>   "uid":"1234567",
>   "card-type": "Tam Kart",     //2020新字段
>   "fare":"3.00",
>   "balance":"40.00",
>   }
>   }
>   }
>   ```
>
>   协议文档见请访问[3914-ASIS客户-刷卡城市国标项目需求V1.0-2024-11-26.docx](https://alidocs.dingtalk.com/i/nodes/vy20BglGWOe9d4RESaq30gwrJA7depqY?utm_scene=team_space)进行下载，关键词可搜索`叠加协议`
>
> - 清空指令
>
>   ```(空)
>   { 
>   "VLDSNG":{ 
>   "transaction-info":{ 
>   "uid":"" 
>   } 
>   } 
>   }
>   ```

> **串口通讯对接**
>
> ##### 配置界面
>
> 在232配置界面，增加一个"Swipe"选项
> ![232配置界面-CP4](https://cdn.jsdelivr.net/gh/maozuxiao/Misaki/20251217111659469.png)
>
> ##### RS232参数
>
> 波特率: 115200
>
> 数据位: 8
>
> 停止位: 1
>
> 校验: No
>
> 
>
> ##### 示例
>
> ```json
> {"VLDSNG":{"transaction-info":{"uid":""}}}
> ```
>
> 
>
> **使用ASCII进行16进制转化后的数据**
>
> ```
> 2a 00 00 00 7b 22 56 4c 44 53 4e 47 22 3a 7b 22 74 72 61 6e 73 61 63 74 69 6f 6e 2d 69 6e 66 6f 22 3a 7b 22 75 69 64 22 3a 22 22 7d
> ```
>
> 其中`2a 00 00 00`为固定包头
>
>  
>
> | 标题             | 说明                                                         | ==                                              |
> | ---------------- | ------------------------------------------------------------ | ----------------------------------------------- |
> | 原文             | {   "VLDSNG":{   "task-info":{   "stopCurrent":{   "routeName":"VALİLİK\|IRLIGANLI",    //2020新字段   "stopName":"Gayrettepe"      //2020新字段   }   },   "vehicle-info":{   "busRegistPlateNo":"34SZ1507",    "speed":30.00,   "latitude":40.995752,   "longitude":28.723370   },   "transaction-info":{   "uid":"1234567",   "card-type": "Tam Kart",   //2020新字段   "fare":"3.00",   "balance":"40.00",}}} | ==                                              |
> | 包头             | ==                                                           | 2a 00 00 00                                     |
> | VLDSNG           | ==                                                           | 56 4c 44 53 4e 47                               |
> | task-info        | ==                                                           | 74 61 73 6b 2d 69 6e 66 6f                      |
> | :                | stopCurrent                                                  | 73 74 6f 70 43 75 72 72 65 6e 74                |
> | :                | routeName                                                    | 72 6f 75 74 65 4e 61 6d 65                      |
> | :                | stopName                                                     | 73 74 6f 70 4e 61 6d 65                         |
> | transaction-info | ==                                                           | 74 72 61 6e 73 61 63 74 69 6f 6e 2d 69 6e 66 6f |
> | :                | uid                                                          | 75 69 64                                        |
> | :                | fare                                                         | 66 61 72 65                                     |
> | :                | balance                                                      | 62 61 6c 61 6e 63 65                            |
> | :                | card**-**type                                                | 63 61 72 64 2d 74 79 70 65                      |
> | vehicle-info     | ==                                                           | 76 65 68 69 63 6c 65 2d 69 6e 66 6f             |
> | :                | busRegistPlateNo                                             | 62 75 73 52 65 67 69 73 74 50 6c 61 74 65 4e 6f |
> | :                | speed                                                        | 73 70 65 65 64                                  |
> | :                | latitude                                                     | 6c 61 74 69 74 75 64 65                         |
> | :                | longitude                                                    | 6c 6f 6e 67 69 74 75 64 65                      |

#### 刷卡信息展示

| 标题     | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 动机目的 | 客户在市场推广时需要将刷卡后的效果展示给终端客户，建立终端客户对使用刷卡功能可达到效果的初步预期。此外，尽管我司有直通视频/录像叠加OSD的功能，可以在视频中展示文字信息，但是客户作为刷卡机公司，客户的终端客户更习惯于看到他们熟悉的刷卡信息。因此调通客户刷卡机后，客户的刷卡信息需要以某种形式直观展示出来。 |
| 正常场景 | 1) 在车队的运维/管理人员查看刷卡信息时，如果只能查看到刷卡信息，终端客户的管理人员无法很好地理解车辆运行时的情况，所以希望刷卡信息（文字信息）能与视频一起展示出来。<br>2) 在车队的管理人员下载一小段录像或证据视频留档时，如果能从视频上实时看到刷卡信息记录/变化过程，可以更好地达到留档的目的。<br>3) 如果客户接了刷卡机但是不刷卡，刷卡信息就无需展示，所以应该有某种方式来控制刷卡信息的展示与否。 |
| 异常场景 | 如果客户接了刷卡机但是没有在主机上配置刷卡机，不应显示任何刷卡信息。 |

##### 需求内容

_^tab^_

> **刷卡信息叠加在视频OSD上进行展示**
>
> ---
>
> - OSD需求
>
>   1. 刷卡信息叠加后，会一直存在屏幕上，不会自动清空。
>   2. 客户会通过CP4(录像与回放)、IE、运维宝、Ceiba2客户端进行录像/实时预览，需确保刷卡信息叠加OSD在录像码流、网传码流、Ceiba2 直通预览界面均需可见
>   3. 若需要清空刷卡信息OSD内容，参考下方文档中的清空指令
>   4. 叠加OSD不需要支持拖动
>   5. 因客户只是从视频中再查看叠加OSD，因此不需要支持该数据写黑匣子，也不需要记录日志
>
> - 显示要求
>
>   ![3914刷卡机显示要求](https://cdn.jsdelivr.net/gh/maozuxiao/Misaki/20251217132213979.png)
>
> > [!CAUTION]
> >
> > 3914刷卡机OSD显示位置与471刷卡机OSD显示位置有差异，请注意区别

> **叠加OSD标题跟随语言切换**
>
> ---
>
> - 语言切换描述
>
>   客户现场会有土耳其语和英语两种使用情况，期望在通讯协议不变的情况下，叠加内容的标题，根据主机选择的语言进行自动切换，选择英语时，显示内容为英文；选择土耳其语时，将标题根据规则改为土耳其语，标题后的内容不需要变。
>
>   > [!NOTE]
>   >
>   > 注意英文标题与土耳其语标题的大小写
>
> - 对应规则
>
>   ```(空)
>   Routename = Rota
>   stopname = Durak
>   busRegistPlateNo = Plaka
>   passengercardnumber = Kart No
>   card-typ = Kart Tipi
>   fare=Ücret
>   balance=Bakiye
>   speed:latitude:longitude=Hız:Enlem:Boylam
>   ```

> **叠加OSD内容显示格式**
>
> ---
>
> - 说明
>
>   共10条信息需要在OSD上进行显示，但是OSD显示上限为8条，因此将速度、经度、维度，变成一行显示，并根据主机语言给速度增加单位：（英文和土耳其语都为km/h，土耳其语为km/sa）
>   
>   英文：Speed:Latitude:Longitude：60.30km/h: 23,0434: 46,2321
>   
>   土耳其：Hız:Enlem:Boylam：60.30km/sa: 23,0434: 46,2321
>   
>   **picDataBase64这一行不需要显示**_~Rd~_
>   
> - 示例
>
>   ```json
>   {
>     "VLDSNG":{
>       "task-info":{
>         "stopCurrent":{
>           "routeName": "VALİLİK|IRLIGANLI",
>           "stopName":"Gayrettepe"
>         }
>       },
>       "vehicle-info":{
>         "busRegistPlateNo":"34SZ1507",
>         "speed":30.00,
>         "latitude":40.995752,
>         "longitude":28.723370
>       },
>       "transaction-info":{
>         "uid":"1234567",
>         "card-type": "Tam Kart",
>         "fare":"3.00 TL",
>         "balance":"40.00 TL",
>         "picDataBase64":"............"
>       }
>     }
>   }
>   ```

> **刷卡机OSD叠加开关**
>
> > [!IMPORTANT]
> >
> > 3914的这个刷卡机OSD叠加需求在471[<kbd>单独控制OSD叠加通道</kbd>](#单独控制OSD叠加通道)需求中亦有记载！可以评估下是否同一需求，进行复用。
>
> 由于刷卡机的OSD不会自动清空，因此需要增加一个使能开关，以控制是否叠加刷卡机的OSD信息。
>
> 在录像OSD界面，增加一个使能开关，名称为：Swipe，以控制刷卡机OSD叠加。
> ![OSD-Swipe Setting](https://cdn.jsdelivr.net/gh/maozuxiao/Misaki/20251217133444560.png)
>
> 该叠加开关只需要控制OSD的叠加即可，不需要设置OSD叠加的位置。
>
> 期望该功能只需要更改主机软件即可控制AHD和IPC的叠加，不需要更改摄像头的软件。
>
> > [!NOTE]
> >
> > 与IPC研发确认：只要主机的叠加OSD功能正常，连接任何AHD与IPC都可在录像/网传码流中看到叠加OSD信息。
> >
> > 若未看到叠加OSD信息，则为问题。

#### 预览界面的新显示策略

| 标题     | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 动机目的 | 我们目前的直通画面显示分为1、4、9分屏，但在公交车项目中客户只关注上、下车门两个通道，且4、9分屏时画面过小不利于观察。公交车在乘客上、下车时，司机需控制对应车门，因此必须实时观察这两个门的通道。尽管现有视频联动可在车门开启（触发IO联动）后显示对应通道，但无法查看开门前的情况，仅依赖视频联动无法满足需求，故需引入新策略。 |
| 正常场景 | 司机在控制前后门时，需要观察前后门的情况，确认安全后才会开/关门。因此需要实时预览画面够大够清晰。 |
| 异常场景 | 增加新策略后，主机原预览功能不能受到影响。                   |

##### 需求内容

1. 增加2分屏预览，去掉原4分屏预览。**新策略为：1/2/9画面预览。**_~Rd~_
2. 改动后有1/2/4和1/2/9两种策略可选。在live view界面上可以选择1/2/4 或1/2/9 分屏，如下图所示：
   ![live view-Mode-1](https://cdn.jsdelivr.net/gh/maozuxiao/Misaki/20251217134546377.png)
3. 直通预览界面底部的菜单栏，也需要将4分屏按钮更改为2分屏按钮；
4. 开机启动画面默认2分屏；2分屏按钮命名为“Double”
5. 1/2/4和1/4/9分别显示效果：
   ![live view-Mode-2](https://cdn.jsdelivr.net/gh/maozuxiao/Misaki/20251217134757551.png)

# Thanks for watching!